(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var l in s)e.o(s,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:s[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.blocks,l=window.wp.i18n,a=window.wp.blockEditor,r=window.wp.components,o=window.wp.element,n=window.wp.apiFetch;var i=e.n(n);(0,s.registerBlockType)("custom-series/series-block",{apiVersion:2,title:(0,l.__)("Series Block","custom-series"),description:(0,l.__)("Display posts from a selected series.","custom-series"),category:"widgets",icon:"list-view",supports:{html:!1,align:!0,color:{text:!0,background:!0,gradients:!0}},attributes:{seriesName:{type:"string",default:""},showTitle:{type:"boolean",default:!0},alignment:{type:"string",default:""}},edit:e=>{const{attributes:s,setAttributes:n}=e,{seriesName:c,showTitle:m,alignment:p}=s,[u,d]=(0,o.useState)([]),[w,g]=(0,o.useState)([]),[_,h]=(0,o.useState)(!0),[E,f]=(0,o.useState)(null),b=(0,a.useBlockProps)({className:"wp-block-custom-series-block"+(p?` align${p}`:"")});(0,o.useEffect)((()=>{v()}),[]),(0,o.useEffect)((()=>{c&&y()}),[c]);const v=async()=>{try{h(!0);const e=await i()({path:"/wp/v2/posts?per_page=100&_fields=id,meta"}),t=[...new Set(e.map((e=>e.meta._series)).filter((e=>e&&e.length>0)))].sort();d(t),f(null)}catch(e){f(e.message)}finally{h(!1)}},y=async()=>{try{h(!0),console.log("Fetching posts for series:",c);const e=await i()({path:`/wp/v2/posts?per_page=100&meta_key=_series&meta_value=${encodeURIComponent(c)}`});console.log("Posts fetched:",e);const t=e.filter((e=>e.meta&&e.meta._series===c));console.log("Filtered posts:",t),g(t),f(null)}catch(e){console.error("Error fetching posts:",e),f(e.message)}finally{h(!1)}},k=[{label:(0,l.__)("Select a series","custom-series"),value:""},...u.map((e=>({label:e,value:e})))];return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:(0,l.__)("Series Settings","custom-series")},(0,t.createElement)(r.SelectControl,{label:(0,l.__)("Series","custom-series"),value:c,options:k,onChange:e=>n({seriesName:e})}),(0,t.createElement)(r.ToggleControl,{label:(0,l.__)("Show Title","custom-series"),checked:m,onChange:e=>n({showTitle:e})}))),(0,t.createElement)("div",{...b},_&&(0,t.createElement)("p",null,(0,l.__)("Loading series...","custom-series")),E&&(0,t.createElement)("p",{className:"error"},E),!_&&!E&&(0,t.createElement)(t.Fragment,null,m&&c&&(0,t.createElement)("h2",{className:"series-title"},c),(0,t.createElement)("div",{className:"series-posts"},c?w.length>0?(0,t.createElement)("ul",null,w.map((e=>(0,t.createElement)("li",{key:e.id},(0,t.createElement)("a",{href:e.link},e.title.rendered))))):(0,t.createElement)("p",null,(0,l.__)("No posts found in this series.","custom-series")):(0,t.createElement)("p",null,(0,l.__)("Please select a series from the block settings.","custom-series"))))))},save:({attributes:e})=>{const{seriesName:s,showTitle:l,alignment:r}=e,o=a.useBlockProps.save({className:"wp-block-custom-series-block"+(r?` align${r}`:"")});return(0,t.createElement)("div",{...o},l&&s&&(0,t.createElement)("h2",{className:"series-title"},s),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("div",{className:"series-posts-container","data-series":s})))}})})();