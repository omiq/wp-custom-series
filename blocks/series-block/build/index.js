(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var l in s)e.o(s,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:s[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.blocks,l=window.wp.i18n,r=window.wp.blockEditor,a=window.wp.components,o=window.wp.element,i=window.wp.apiFetch;var n=e.n(i);(0,s.registerBlockType)("custom-series/series-block",{apiVersion:2,title:(0,l.__)("Series Block","custom-series"),description:(0,l.__)("Display posts from a selected series.","custom-series"),category:"widgets",icon:"list-view",supports:{html:!1,align:!0,color:{text:!0,background:!0,gradients:!0}},attributes:{seriesName:{type:"string",default:""},showTitle:{type:"boolean",default:!0}},edit:e=>{const{attributes:s,setAttributes:i}=e,{seriesName:c,showTitle:m}=s,[p,u]=(0,o.useState)([]),[d,w]=(0,o.useState)([]),[g,_]=(0,o.useState)(!0),[h,E]=(0,o.useState)(null),b=(0,r.useBlockProps)({className:"wp-block-custom-series-block"});(0,o.useEffect)((()=>{f()}),[]),(0,o.useEffect)((()=>{c&&v()}),[c]);const f=async()=>{try{_(!0);const e=await n()({path:"/wp/v2/posts?per_page=100&_fields=id,meta"}),t=[...new Set(e.map((e=>e.meta._series)).filter((e=>e&&e.length>0)))].sort();u(t),E(null)}catch(e){E(e.message)}finally{_(!1)}},v=async()=>{try{_(!0),console.log("Fetching posts for series:",c);const e=await n()({path:`/wp/v2/posts?per_page=100&meta_key=_series&meta_value=${encodeURIComponent(c)}`});console.log("Posts fetched:",e);const t=e.filter((e=>e.meta&&e.meta._series===c));console.log("Filtered posts:",t),w(t),E(null)}catch(e){console.error("Error fetching posts:",e),E(e.message)}finally{_(!1)}},k=[{label:(0,l.__)("Select a series","custom-series"),value:""},...p.map((e=>({label:e,value:e})))];return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(r.InspectorControls,null,(0,t.createElement)(a.PanelBody,{title:(0,l.__)("Series Settings","custom-series")},(0,t.createElement)(a.SelectControl,{label:(0,l.__)("Series","custom-series"),value:c,options:k,onChange:e=>i({seriesName:e})}),(0,t.createElement)(a.ToggleControl,{label:(0,l.__)("Show Title","custom-series"),checked:m,onChange:e=>i({showTitle:e})}))),(0,t.createElement)("div",{...b},g&&(0,t.createElement)("p",null,(0,l.__)("Loading series...","custom-series")),h&&(0,t.createElement)("p",{className:"error"},h),!g&&!h&&(0,t.createElement)(t.Fragment,null,m&&c&&(0,t.createElement)("h2",{className:"series-title"},c),(0,t.createElement)("div",{className:"series-posts"},c?d.length>0?(0,t.createElement)("ul",null,d.map((e=>(0,t.createElement)("li",{key:e.id},(0,t.createElement)("a",{href:e.link},e.title.rendered))))):(0,t.createElement)("p",null,(0,l.__)("No posts found in this series.","custom-series")):(0,t.createElement)("p",null,(0,l.__)("Please select a series from the block settings.","custom-series"))))))},save:({attributes:e})=>{const{seriesName:s,showTitle:l}=e,a=r.useBlockProps.save({className:"wp-block-custom-series-block"});return(0,t.createElement)("div",{...a},l&&s&&(0,t.createElement)("h2",{className:"series-title"},s),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("div",{className:"series-posts-container","data-series":s})))}})})();