(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.blocks,r=window.wp.i18n,a=window.wp.blockEditor,i=window.wp.components,o=window.wp.element,l=window.wp.apiFetch;var n=e.n(l);(0,s.registerBlockType)("custom-series/series-block",{apiVersion:2,title:(0,r.__)("Series Block","custom-series"),description:(0,r.__)("Display posts from a selected series.","custom-series"),category:"widgets",icon:"list-view",attributes:{seriesName:{type:"string",default:""},showTitle:{type:"boolean",default:!0},alignment:{type:"string",default:""},backgroundColor:{type:"string",default:""},textColor:{type:"string",default:""},borderColor:{type:"string",default:""},borderWidth:{type:"string",default:""},borderRadius:{type:"string",default:""},fontSize:{type:"string",default:""},fontFamily:{type:"string",default:""},fontWeight:{type:"string",default:""},lineHeight:{type:"string",default:""},textTransform:{type:"string",default:""},letterSpacing:{type:"string",default:""},style:{type:"object",default:{}}},supports:{align:!0,html:!1,color:{text:!0,background:!0,gradients:!0},border:{color:!0,radius:!0,width:!0},spacing:{margin:!0,padding:!0},typography:{fontSize:!0,lineHeight:!0,fontFamily:!0,fontWeight:!0,textTransform:!0,letterSpacing:!0}},edit:e=>{const{attributes:s,setAttributes:l}=e,{seriesName:d,showTitle:c,alignment:m}=s,[p,g]=(0,o.useState)([]),[u,f]=(0,o.useState)(!0),[h,y]=(0,o.useState)(null),[b,w]=(0,o.useState)([]),[v,_]=(0,o.useState)(!1),$=e=>"string"==typeof e?e:e&&"object"==typeof e&&e.rendered?e.rendered:"",E=(0,a.useBlockProps)({className:"wp-block-custom-series-series-block"+(m?` align${m}`:"")}),k=(0,o.useCallback)((async()=>{try{f(!0);const e=await n()({path:"/wp/v2/posts?per_page=100&_fields=id,meta"}),t=[...new Set(e.map((e=>e.meta._series)).filter((e=>e&&e.length>0)))].sort();g(t),y(null)}catch(e){y(e.message)}finally{f(!1)}}),[]),S=(0,o.useCallback)((async e=>{if(e)try{_(!0);const t=(await n()({path:`/wp/v2/posts?per_page=100&meta_key=_series&meta_value=${encodeURIComponent(e)}&orderby=date&order=asc&_fields=id,title,link,date,meta`,parse:!0})).filter((t=>t.meta&&t.meta._series===e)).map((e=>({...e,title:$(e.title)})));w(t),y(null)}catch(e){y(e.message)}finally{_(!1)}}),[]);return(0,o.useEffect)((()=>{k()}),[k]),(0,o.useEffect)((()=>{d?S(d):w([])}),[d,S]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(i.PanelBody,{title:(0,r.__)("Series Settings","custom-series")},(0,t.createElement)(i.SelectControl,{label:(0,r.__)("Select Series","custom-series"),value:d,options:[{label:(0,r.__)("Select a series","custom-series"),value:""},...p.map((e=>({label:e,value:e})))],onChange:e=>l({seriesName:e})}),(0,t.createElement)(i.ToggleControl,{label:(0,r.__)("Show Series Title","custom-series"),checked:c,onChange:e=>l({showTitle:e})}))),(0,t.createElement)("div",{...E},u?(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("Loading series...","custom-series")):h?(0,t.createElement)("div",{className:"series-error"},(0,t.createElement)("div",{className:"error"},h)):d?v?(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("Loading posts...","custom-series")):0===b.length?(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("No posts found in this series","custom-series")):(0,t.createElement)(t.Fragment,null,c&&d&&(0,t.createElement)("h2",{className:"series-title"},d),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("ul",{className:"series-posts-list"},b.map((e=>(0,t.createElement)("li",{key:e.id,className:"series-post-item"},(0,t.createElement)("a",{href:e.link},$(e.title)))))))):(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("Select a series to display","custom-series"))))},save:({attributes:e})=>{const{seriesName:s,showTitle:r,alignment:i,backgroundColor:o,textColor:l,borderColor:n,borderWidth:d,borderRadius:c,fontSize:m,fontFamily:p,fontWeight:g,lineHeight:u,textTransform:f,letterSpacing:h,style:y}=e,b={};if(o&&(b.backgroundColor=`var(--wp--preset--color--${o})`),l&&(b.color=`var(--wp--preset--color--${l})`),n&&(b.borderColor=`var(--wp--preset--color--${n})`),d&&(b.borderWidth=d),c&&(b.borderRadius=c),m&&(b.fontSize=`var(--wp--preset--font-size--${m})`),p&&(b.fontFamily=`var(--wp--preset--font-family--${p})`),g&&(b.fontWeight=g),u&&(b.lineHeight=`${u}em`),f&&(b.textTransform=f),h&&(b.letterSpacing=`${h}px`),y&&y.spacing){const e=y.spacing;e.margin&&(b.marginTop=e.margin.top?`${e.margin.top}em`:void 0,b.marginRight=e.margin.right?`${e.margin.right}em`:void 0,b.marginBottom=e.margin.bottom?`${e.margin.bottom}em`:void 0,b.marginLeft=e.margin.left?`${e.margin.left}em`:void 0),e.padding&&(b.paddingTop=e.padding.top?`${e.padding.top}em`:void 0,b.paddingRight=e.padding.right?`${e.padding.right}em`:void 0,b.paddingBottom=e.padding.bottom?`${e.padding.bottom}em`:void 0,b.paddingLeft=e.padding.left?`${e.padding.left}em`:void 0)}const w=a.useBlockProps.save({className:`wp-block-custom-series-series-block${i?` align${i}`:""}${m?` has-${m}-font-size`:""}${p?` has-${p}-font-family`:""}${o?` has-${o}-background-color has-background`:""}${l?` has-${l}-color has-text-color`:""}${n?` has-${n}-border-color`:""}`,style:b});return(0,t.createElement)("div",{...w},r&&s&&(0,t.createElement)("h2",{className:"series-title"},s),(0,t.createElement)("div",{className:"series-posts",style:u?{lineHeight:`${u}em`}:void 0},(0,t.createElement)("div",{className:"series-posts-container","data-series":s})))}})})();