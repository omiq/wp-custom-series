(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.blocks,a=window.wp.i18n,l=window.wp.blockEditor,r=window.wp.components,i=window.wp.element,o=window.wp.apiFetch;var n=e.n(o);(0,s.registerBlockType)("custom-series/series-block",{apiVersion:2,title:(0,a.__)("Series Block","custom-series"),description:(0,a.__)("Display posts from a selected series.","custom-series"),category:"widgets",icon:"list-view",attributes:{seriesName:{type:"string",default:""},showTitle:{type:"boolean",default:!0},alignment:{type:"string",default:""}},supports:{align:!0,html:!1,color:{text:!0,background:!0,gradients:!0},border:{color:!0,radius:!0,style:!0,width:!0},spacing:{margin:!0,padding:!0},typography:{fontSize:!0,lineHeight:!0}},edit:e=>{const{attributes:s,setAttributes:o}=e,{seriesName:c,showTitle:m,alignment:u}=s,[p,d]=(0,i.useState)([]),[w,g]=(0,i.useState)(!0),[_,b]=(0,i.useState)(null),[h,y]=(0,i.useState)([]),[E,f]=(0,i.useState)(!1),k=(0,l.useBlockProps)({className:"wp-block-custom-series-block"+(u?` align${u}`:"")}),S=(0,i.useCallback)((async()=>{try{g(!0);const e=await n()({path:"/wp/v2/posts?per_page=100&_fields=id,meta"}),t=[...new Set(e.map((e=>e.meta._series)).filter((e=>e&&e.length>0)))].sort();d(t),b(null)}catch(e){b(e.message)}finally{g(!1)}}),[]),v=(0,i.useCallback)((async e=>{if(e)try{f(!0);const t=(await n()({path:`/wp/v2/posts?per_page=100&meta_key=_series&meta_value=${encodeURIComponent(e)}`})).filter((t=>t.meta&&t.meta._series===e));y(t),b(null)}catch(e){b(e.message)}finally{f(!1)}}),[]);return(0,i.useEffect)((()=>{S()}),[S]),(0,i.useEffect)((()=>{c?v(c):y([])}),[c,v]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:(0,a.__)("Series Settings","custom-series")},(0,t.createElement)(r.SelectControl,{label:(0,a.__)("Select Series","custom-series"),value:c,options:[{label:(0,a.__)("Select a series","custom-series"),value:""},...p.map((e=>({label:e,value:e})))],onChange:e=>o({seriesName:e}),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,t.createElement)(r.ToggleControl,{label:(0,a.__)("Show Series Title","custom-series"),checked:m,onChange:e=>o({showTitle:e}),__nextHasNoMarginBottom:!0}))),(0,t.createElement)("div",{...k},w?(0,t.createElement)("p",null,(0,a.__)("Loading series...","custom-series")):_?(0,t.createElement)("p",{className:"error"},_):(0,t.createElement)(t.Fragment,null,m&&c&&(0,t.createElement)("h2",{className:"series-title"},c),E?(0,t.createElement)("p",null,(0,a.__)("Loading posts...","custom-series")):h.length>0?(0,t.createElement)("ul",{className:"series-posts"},h.map((e=>(0,t.createElement)("li",{key:e.id},(0,t.createElement)("a",{href:e.link},e.title.rendered))))):c&&(0,t.createElement)("p",null,(0,a.__)("No posts found in this series.","custom-series")))))},save:({attributes:e})=>{const{seriesName:s,showTitle:a,alignment:r}=e,i=l.useBlockProps.save({className:"wp-block-custom-series-series-block wp-block-custom-series-block"+(r?` align${r}`:""),style:{borderColor:"",borderWidth:"",borderStyle:"",borderRadius:""}});return(0,t.createElement)("div",{...i},a&&s&&(0,t.createElement)("h2",{className:"series-title"},s),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("div",{className:"series-posts-container","data-series":s})))}})})();