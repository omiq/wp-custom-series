(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.blocks,r=window.wp.i18n,a=window.wp.blockEditor,l=window.wp.components,i=window.wp.element,o=window.wp.apiFetch;var n=e.n(o);(0,s.registerBlockType)("custom-series/series-block",{apiVersion:2,title:(0,r.__)("Series Block","custom-series"),description:(0,r.__)("Display posts from a selected series.","custom-series"),category:"widgets",icon:"list-view",attributes:{seriesName:{type:"string",default:""},showTitle:{type:"boolean",default:!0},alignment:{type:"string",default:""},backgroundColor:{type:"string",default:""},textColor:{type:"string",default:""},borderColor:{type:"string",default:""},borderWidth:{type:"string",default:""},borderRadius:{type:"string",default:""}},supports:{align:!0,html:!1,color:{text:!0,background:!0,gradients:!0},border:{color:!0,radius:!0,width:!0},spacing:{margin:!0,padding:!0},typography:{fontSize:!0,lineHeight:!0}},edit:e=>{const{attributes:s,setAttributes:o}=e,{seriesName:c,showTitle:d,alignment:m}=s,[p,u]=(0,i.useState)([]),[g,b]=(0,i.useState)(!0),[w,h]=(0,i.useState)(null),[_,y]=(0,i.useState)([]),[f,E]=(0,i.useState)(!1),v=e=>"string"==typeof e?e:e&&"object"==typeof e&&e.rendered?e.rendered:"",k=(0,a.useBlockProps)({className:"wp-block-custom-series-series-block"+(m?` align${m}`:"")}),N=(0,i.useCallback)((async()=>{try{b(!0);const e=await n()({path:"/wp/v2/posts?per_page=100&_fields=id,meta"}),t=[...new Set(e.map((e=>e.meta._series)).filter((e=>e&&e.length>0)))].sort();u(t),h(null)}catch(e){h(e.message)}finally{b(!1)}}),[]),S=(0,i.useCallback)((async e=>{if(e)try{E(!0);const t=(await n()({path:`/wp/v2/posts?per_page=100&meta_key=_series&meta_value=${encodeURIComponent(e)}&orderby=date&order=asc&_fields=id,title,link,date,meta`,parse:!0})).filter((t=>t.meta&&t.meta._series===e)).map((e=>({...e,title:v(e.title)})));y(t),h(null)}catch(e){h(e.message)}finally{E(!1)}}),[]);return(0,i.useEffect)((()=>{N()}),[N]),(0,i.useEffect)((()=>{c?S(c):y([])}),[c,S]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:(0,r.__)("Series Settings","custom-series")},(0,t.createElement)(l.SelectControl,{label:(0,r.__)("Select Series","custom-series"),value:c,options:[{label:(0,r.__)("Select a series","custom-series"),value:""},...p.map((e=>({label:e,value:e})))],onChange:e=>o({seriesName:e})}),(0,t.createElement)(l.ToggleControl,{label:(0,r.__)("Show Series Title","custom-series"),checked:d,onChange:e=>o({showTitle:e})}))),(0,t.createElement)("div",{...k},g?(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("Loading series...","custom-series")):w?(0,t.createElement)("div",{className:"series-error"},(0,t.createElement)("div",{className:"error"},w)):c?f?(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("Loading posts...","custom-series")):0===_.length?(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("No posts found in this series","custom-series")):(0,t.createElement)(t.Fragment,null,d&&c&&(0,t.createElement)("h2",{className:"series-title"},c),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("ul",{className:"series-posts-list"},_.map((e=>(0,t.createElement)("li",{key:e.id,className:"series-post-item"},(0,t.createElement)("a",{href:e.link},v(e.title)))))))):(0,t.createElement)("div",{className:"series-placeholder"},(0,r.__)("Select a series to display","custom-series"))))},save:({attributes:e})=>{const{seriesName:s,showTitle:r,alignment:l,backgroundColor:i,textColor:o,borderColor:n,borderWidth:c,borderRadius:d}=e,m=a.useBlockProps.save({className:"wp-block-custom-series-series-block"+(l?` align${l}`:""),style:{backgroundColor:i,color:o,borderColor:n,borderWidth:c,borderRadius:d}});return(0,t.createElement)("div",{...m},r&&s&&(0,t.createElement)("h2",{className:"series-title"},s),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("div",{className:"series-posts-container","data-series":s})))}})})();