(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.blocks,r=window.wp.i18n,o=window.wp.blockEditor,l=window.wp.components,a=window.wp.element,n=window.wp.apiFetch;var i=e.n(n);const c=window.wp.compose;(0,s.registerBlockType)("custom-series/series-block",{apiVersion:3,title:(0,r.__)("Series List","custom-series"),icon:"editor-ol",category:"widgets",attributes:{seriesName:{type:"string",default:""},showTitle:{type:"boolean",default:!0},alignment:{type:"string",default:"left"},textColor:{type:"string",default:""},backgroundColor:{type:"string",default:""}},edit:(0,c.compose)([(0,o.withColors)("textColor","backgroundColor")])((({attributes:e,setAttributes:s,textColor:n,backgroundColor:c,setTextColor:m,setBackgroundColor:u})=>{const[d,p]=(0,a.useState)([]),[w,g]=(0,a.useState)(!0),[h,_]=(0,a.useState)(null),[f,E]=(0,a.useState)([]),[b,C]=(0,a.useState)(!1),y=(0,o.useBlockProps)({style:{textAlign:e.alignment,color:n?.color,backgroundColor:c?.color}}),k=(0,a.useCallback)((async()=>{try{g(!0),_(null);const e=await i()({path:"/wp/v2/posts?per_page=100"});if(!e||!Array.isArray(e))throw new Error("Invalid response format");const t=new Set;e.forEach((e=>{e.meta&&e.meta._series&&t.add(e.meta._series)})),p(Array.from(t).sort())}catch(e){console.error("Error fetching series:",e),_(e.message||"Failed to fetch series data")}finally{g(!1)}}),[]),v=(0,a.useCallback)((async()=>{if(e.seriesName)try{C(!0);const t=await i()({path:"/wp/v2/posts?per_page=100"});if(!t||!Array.isArray(t))throw new Error("Invalid response format");const s=t.filter((t=>t.meta&&t.meta._series===e.seriesName));s.sort(((e,t)=>new Date(t.date)-new Date(e.date))),E(s)}catch(e){console.error("Error fetching series posts:",e),_(e.message||"Failed to fetch series posts")}finally{C(!1)}else E([])}),[e.seriesName]);(0,a.useEffect)((()=>{k()}),[k]),(0,a.useEffect)((()=>{v()}),[v]);const S=(0,a.useMemo)((()=>[{label:(0,r.__)("Select a series...","custom-series"),value:""},...d.map((e=>({label:e,value:e})))]),[d]),N=(0,a.useMemo)((()=>[{value:n?.color,onChange:m,label:(0,r.__)("Text Color","custom-series")},{value:c?.color,onChange:u,label:(0,r.__)("Background Color","custom-series")}]),[n?.color,c?.color,m,u]);return(0,t.createElement)("div",{...y},(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:(0,r.__)("Series Settings","custom-series")},(0,t.createElement)(l.SelectControl,{label:(0,r.__)("Select Series","custom-series"),value:e.seriesName,options:S,onChange:e=>s({seriesName:e}),disabled:w}),(0,t.createElement)(l.ToggleControl,{label:(0,r.__)("Show Title","custom-series"),checked:e.showTitle,onChange:e=>s({showTitle:e})}),(0,t.createElement)(l.AlignmentControl,{value:e.alignment,onChange:e=>s({alignment:e})})),(0,t.createElement)(o.PanelColorSettings,{title:(0,r.__)("Color Settings","custom-series"),colorSettings:N})),(0,t.createElement)("div",{className:"wp-block-custom-series-series-block"},w?(0,t.createElement)("p",null,(0,r.__)("Loading series...","custom-series")):h?(0,t.createElement)("p",{className:"error-message"},h):e.seriesName?(0,t.createElement)(t.Fragment,null,e.showTitle&&(0,t.createElement)("h2",null,e.seriesName),(0,t.createElement)("div",{className:"series-posts-list"},b?(0,t.createElement)("p",null,(0,r.__)("Loading posts...","custom-series")):f.length>0?(0,t.createElement)("ul",null,f.map((e=>(0,t.createElement)("li",{key:e.id},(0,t.createElement)("a",{href:e.link},e.title.rendered))))):(0,t.createElement)("p",null,(0,r.__)("No posts found in this series.","custom-series")))):(0,t.createElement)("p",null,(0,r.__)("Please select a series from the block settings.","custom-series"))))})),save:({attributes:e})=>e.seriesName?(0,t.createElement)("div",{className:"wp-block-custom-series-series-block"},e.showTitle&&(0,t.createElement)("h2",null,e.seriesName),(0,t.createElement)("div",{className:"series-posts-list"})):null})})();