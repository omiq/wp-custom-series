(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.blocks,a=window.wp.i18n,l=window.wp.blockEditor,r=window.wp.components,o=window.wp.element,i=window.wp.apiFetch;var n=e.n(i);(0,s.registerBlockType)("custom-series/series-block",{apiVersion:2,title:(0,a.__)("Series Block","custom-series"),description:(0,a.__)("Display posts from a selected series.","custom-series"),category:"widgets",icon:"list-view",attributes:{seriesName:{type:"string",default:""},showTitle:{type:"boolean",default:!0},alignment:{type:"string",default:""},backgroundColor:{type:"string",default:""},textColor:{type:"string",default:""}},supports:{align:!0,html:!1,color:{text:!0,background:!0,gradients:!0},border:{color:!0,radius:!0,style:!0,width:!0},spacing:{margin:!0,padding:!0},typography:{fontSize:!0,lineHeight:!0}},edit:e=>{const{attributes:s,setAttributes:i}=e,{seriesName:c,showTitle:m,alignment:d}=s,[p,u]=(0,o.useState)([]),[g,_]=(0,o.useState)(!0),[w,h]=(0,o.useState)(null),[b,E]=(0,o.useState)([]),[y,v]=(0,o.useState)(!1),f=(0,l.useBlockProps)({className:"wp-block-custom-series-series-block"+(d?` align${d}`:"")}),k=(0,o.useCallback)((async()=>{try{_(!0);const e=await n()({path:"/wp/v2/posts?per_page=100&_fields=id,meta"}),t=[...new Set(e.map((e=>e.meta._series)).filter((e=>e&&e.length>0)))].sort();u(t),h(null)}catch(e){h(e.message)}finally{_(!1)}}),[]),C=(0,o.useCallback)((async e=>{if(e)try{v(!0);const t=(await n()({path:`/wp/v2/posts?per_page=100&meta_key=_series&meta_value=${encodeURIComponent(e)}&orderby=date&order=asc&_fields=id,title,link,date,meta`,parse:!0})).filter((t=>t.meta&&t.meta._series===e));E(t),h(null)}catch(e){h(e.message)}finally{v(!1)}}),[]);return(0,o.useEffect)((()=>{k()}),[k]),(0,o.useEffect)((()=>{c?C(c):E([])}),[c,C]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:(0,a.__)("Series Settings","custom-series")},(0,t.createElement)(r.SelectControl,{label:(0,a.__)("Select Series","custom-series"),value:c,options:[{label:(0,a.__)("Select a series","custom-series"),value:""},...p.map((e=>({label:e,value:e})))],onChange:e=>i({seriesName:e})}),(0,t.createElement)(r.ToggleControl,{label:(0,a.__)("Show Series Title","custom-series"),checked:m,onChange:e=>i({showTitle:e})})),(0,t.createElement)(l.__experimentalPanelColorGradientSettings,{title:(0,a.__)("Color Settings","custom-series"),settings:[{colorValue:s.backgroundColor,onColorChange:e=>i({backgroundColor:e}),label:(0,a.__)("Background Color","custom-series")},{colorValue:s.textColor,onColorChange:e=>i({textColor:e}),label:(0,a.__)("Text Color","custom-series")}]})),(0,t.createElement)("div",{...f},g?(0,t.createElement)("div",{className:"series-placeholder"},(0,a.__)("Loading series...","custom-series")):w?(0,t.createElement)("div",{className:"series-error"},(0,t.createElement)("div",{className:"error"},w)):c?y?(0,t.createElement)("div",{className:"series-placeholder"},(0,a.__)("Loading posts...","custom-series")):0===b.length?(0,t.createElement)("div",{className:"series-placeholder"},(0,a.__)("No posts found in this series","custom-series")):(0,t.createElement)(t.Fragment,null,m&&c&&(0,t.createElement)("h2",{className:"series-title"},c),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("ul",{className:"series-posts-list"},b.map((e=>(0,t.createElement)("li",{key:e.id,className:"series-post-item"},(0,t.createElement)("a",{href:e.link},e.title),(0,t.createElement)("span",{className:"post-date"},new Date(e.date).toLocaleDateString()))))))):(0,t.createElement)("div",{className:"series-placeholder"},(0,a.__)("Select a series to display","custom-series"))))},save:({attributes:e})=>{const{seriesName:s,showTitle:a,alignment:r}=e,o=l.useBlockProps.save({className:"wp-block-custom-series-series-block"+(r?` align${r}`:"")});return(0,t.createElement)("div",{...o},a&&s&&(0,t.createElement)("h2",{className:"series-title"},s),(0,t.createElement)("div",{className:"series-posts"},(0,t.createElement)("div",{className:"series-posts-container","data-series":s})))}})})();